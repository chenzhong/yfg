
#团购商品添加新流程设计方案#

##方案流程图##

<img src='tuan_new_product.jpg'/>


##功能模块说明##


### 有享团供应商管理平台###

#### 商品管理 > 所有商品 ####


**查询**

> 以商品编号、商品名称（模糊查询）、审核状态、商品状态、是否首页显示、商品添加来源（add\_from=2）为查询条件，以列表的形式进行展示，列表项：
> 
> 商品编码、商品标题、商品库存、仓库类型、是否有享网做图、市场价、有享价、商品分类、商品状态、是否首页显示、浏览次数、上架时间、下架时间、添加时间。


**新增**

> 点击新增按钮，跳转到新增商品页面，页面内容：
>
	1、商品SKU分类（下拉列表），SKU属性。选择SKU分类，动态显示SKU属性，供应商勾选自己对应的商品的SKU属性。
    2、仓库类型（下拉列表： 实仓/虚仓），备注说明：实仓是指需要发货到有享网仓库的商品
    3、商品库存，默认为0，备注说明：默认为0，表示库存无限
    4、商品分类：从类目表获取到商品的类目。
    5、运费模板：根据供应商，查找shop_postagemode，获取到该供应商下对应的运费模版
    6、商品毛重：默认1000，输入框后面加上单位：克
    7、几件起免运费（下拉列表）：默认每件需要运费，备注说明：可直接输入您想要的数字；当运费模版是免运费时，该选项无效。
	8、商品标题（250个字以内）
    9、三包期限：默认为0，备注说明：以月为单位，0表示没有三包期限信息，-1表示终身保修
    10、详细页面主图：453x340
    11、往期团购图片：200x120
    12、首页列表图片：280x190
    13、搜狗API图片：280x175
    14、市场价格
	15、建议有享价（写入数据库的是有享价这个字段）
	16、每人限购数量，备注说明：即一个用户可以购买的数量，默认为0，表示无限制
    17、是否有享网做图（复选框），默认不勾选，若勾选，该下方显示备注输入框（输入框旁加上提示信息：请在备注框中注明需要有享网做哪些图片），
		表单提交时，需要判断该输入框是否为空，若为空，则不能提交。
    18、商品描述
    19、商品添加来源，隐藏域，add_from=2
	20、商品上架时间与下架时间，上架时间默认00:00:00，下架时间默认：23:59:59。

> 详细页面主图、往期团购图片、首页列表图片、搜狗API图片，这四项可以为空，其余内容都为必填项，
> 点击提交按钮，对数字及图片大小需要做验证（这块参考现有的团购添加商品功能），验证通过后，将内容写入到数据库中，所属的店铺为当前的供应商，is\_edit置为1。

**修改**

> 选中一个商品，点击修改按钮，判断该商品的审核状态是否为编辑中、一审不通过、二审不通过、三审不通过(audit\_status=1||audit\_status=3||<span style="color:red">audit\_status=6||audit\_status=8</span>)，
> 若不是，则不能修改，并给出相应的提示信息。
> 若是，则进入修改页面，页面内容：同添加。点击提交按钮，对数字及图片大小需要做验证（这块参考现有的团购修改商品功能），验证通过后，将内容写入到数据库中，audit\_status置为1，is\_edit置为1。

**提交审核**

> 勾选商品，点击提交审核按钮，需做如下判断
> 
	1、判断该商品的is_edit是否为1，若不是，则不能提交审核，并给出相应的提示信息。
	2、判断选中的商品的审核状态是否为1，若是1，则将该商品的审核状态置为待一审(audit_status=2)，
	   若不是1，则不能改变商品的审核状态，并将该商品编号及该商品的审核状态放入map中。
> 
> 当遍历完所有商品后，弹出提示框——“提交成功X个，失败X个，失败原因：商品xxx状态为xx，不能提交审核！”，失败原因需要换行，一行一个失败原因。
> 
> 提交审核后，商品的状态为待一审状态(audit\_status=2)。

**<span style="color:red">撤销提交</span>**

> 选中一个商品，点击撤销提交按钮，需做如下验证：
> 
	该商品是否处于待一审状态，若不是，则不能撤销，并给出相应的提示信息。

> 验证通过后，将撤销审核的商品状态置为编辑中，更新最后一次撤销时间。

**<span style="color:red">删除</span>**
>
>选中一个商品，点击删除按钮，需做如下验证：
>
	该商品的审核状态是否是编辑中或者一审未通过商品，若不是，则不能删除，并给出提示信息。

> <span style="color:red">tips:需处理的表：item，sku，各个站点下的该商品记录，item\_for\_label</span>

**商品复制**

> 在原有的商品复制功能上新增一个字段：商品添加来源。
> 
> 复制的商品必须先修改才能提交审核。



**查看审核记录**

> 选中商品，点击查看审核记录按钮，弹出div层，div层内容：
> 
	审核记录列表，列表项：审核类型、审核意见、审核人、审核时间、备注。
	

#### <span style="color:red">物流管理 > 运费模版管理</span> ####

**<span style="color:red">查询</span>**

> 查询运费模版表（PostageMode）和店铺运费模版关联表（shop_postagemode），获取到该店铺的运费模板，
> 通过模版编号、模版名称、模块状态为查询条件，
> 以列表的形式进行展示，列表项：编号、运费模版名称、快递费用、快递加件费用、创建时间、修改日期、状态、添加来源。

**<span style="color:red">添加</span>**

> 同后台的运费模板添加功能。在此基础上，添加时，需将商家ID写入到PostageMode表中，并且PostageMode.add\_from置为1。
> 同时需将运费模板ID、商家ID、创建人、创建时间一起写入shop_postagemode表中。

**<span style="color:red">修改</span>**

> 同后台的运费模板修改功能。在此基础上，需在进入修改页面及点击提交时，都需做如下判断：
> 	
	1、该运费模板的add_from是否为1，若不为1，则不能修改。
	2、该运费模版绑定的商品是否有待一审（audit_status=2）、待二审（audit_status=4）、二审通过（audit_status=5）、三审通过（audit_status=7）这四种状态，
	   若有，则不能修改。

> 修改完成后，写入日志，供应商平台修改日志与后台修改日志需做区分。

**<span style="color:red">查看详细</span>**

> 同后台的运费模板查看详细功能。

**<span style="color:red">添加运费模板项</span>**

> 同后台的添加运费模板项功能。在此基础上，点击添加运费模板项按钮及点击提交时，都需做如下判断：
> 	
	1、该运费模板的add_from是否为1，若不为1，则不能添加。
	2、该运费模版绑定的商品是否有待一审（audit_status=2）、待二审（audit_status=4）、二审通过（audit_status=5）、三审通过（audit_status=7）这四种状态，
	   若有，则不能添加。

> 添加完成后，需写入日志，供应商平台修改日志与后台修改日志需做区分。

**<span style="color:red">复制模版</span>**

> 同后台的复制模版功能。在此基础上，需将商家ID写入到PostageMode表中，并且PostageMode.add\_from置为1。
> 同时需将运费模板ID、商家ID、创建人、创建时间一起写入shop_postagemode表中。


### 有享网后台管理系统(yofogoadmin)###


#### 团购 -> 商品管理 -> 所有商品 ####

**查询**
> 
> 新增查询：是否有享网做图、商品上架时间段、审核状态、商品来源。
> 
> 列表新增列：是否有享网做图、审核状态、商品来源、仓库类型。
> 

**查看详细**
> 在查看详细页面增加四个字段的显示：是否有享网做图，审核状态、商品来源、备注

**新增**

> 新增的商品写入数据库时，在原有的基础上，需要将is_edit置为1。

**修改**

> 选中一个商品，点击修改按钮，做如下处理：
>
	若是后台添加的商品：
	 	一审不通过、二审不通过、三审不通过，需将审核状态置为编辑中。
	若是供应商添加的商品：
		不更改审核状态

**提交审核**

> 勾选商品，点击提交审核按钮，需做如下判断
> 
	1、判断该商品的is_edit是否为1，若不是，则不能提交审核，并给出相应的提示信息。
	2、判断选中的商品的审核状态是否为1，若是1，则将该商品的审核状态置为待一审(audit_status=2)，
	   若不是1，则不能改变商品的审核状态，并将该商品编号及该商品的审核状态放入map中。
> 
> 
> 当遍历完所有商品后，弹出提示框——“提交成功X个，失败X个，失败原因：商品xxx状态为xx，不能提交审核！”，失败原因需要换行，一行一个失败原因。
> 
> 提交审核后，商品的状态为待一审状态(audit_status=2)。

**上架**

> 选中一个商品，点击上架按钮，在原有的基础上，还需增加一个判断：判断该商品是否三审通过(audit_status=7)，若不是，则不能上架，并给出相应的提示信息。

**商品复制**

> 在原有的商品复制功能上新增一个字段：商品添加来源。
> 
> 复制的商品必须先修改才能提交审核。

**商品状态修改**

> 若该商品从编辑中变为即将开团，需要判断该商品的审核状态是否为三审通过(audit_status=7)，若不是，则不能通过，并给出相应的提示信息。

#### 团购 -> 商品管理 -> 待一审的商品 ####


**查询**

> 以商品编号、商品名称（模糊查询）、审核状态(audit\_status=2)、商品状态为查询条件，以列表的形式进行展示，列表项：
> 
> 商品编码、商品标题、商品库存、仓库类型、是否有享网做图、市场价、有享价、商品分类、商品状态、审核状态、商品来源、是否首页显示、浏览次数、上架时间、下架时间、添加时间。
> 按照上架时间升序来排序。

**查看详细**

> 同所有商品的查看详细功能。

**审核**

> 选中商品，点击审核按钮，进入审核页面，页面内容：同查看详细页面
> 页面底部有审核意见编辑框、一审通过按钮、一审不通过按钮、修改按钮。
> 
> 一审通过
>
> 点击一审通过按钮，需作如下处理：
>
>	 1、<span style="color:red">验证该商品是否为待一审状态，若不是，则不能审核。</span>
>	 
>    2、商品的审核状态置为待二审（audit_status=4）。
>    
>    3、审核意见若没有填写，直接给审核意见赋值——‘一审通过’。
>    
>    4、若审核意见不为空，则在审核意见前面加上‘一审通过：’

> 一审不通过
> 
>	点击一审不通过按钮，需做如下处理：
>
>	 1、<span style="color:red">验证该商品是否为待一审状态，若不是，则不能审核。</span>
>	 
>    2、商品的审核状态置为一审不通过(audit_status=3)。
>    
>    3、审核意见需要填写，并在审核意见前面加上‘一审不通过：’，若为空，则不能提交。


> 修改
> 
	点击修改按钮，跳往修改页面，页面内容同现有的修改页面
	商品标题、详细页面主图、往期团购图片、新版列表图片、搜狗API图片、商品描述这几项为可编辑状态，
	其余各项为不可编辑状态。点击提交按钮后，会将数据写入到数据库中，保存完后，返回到审核页面。
	修改页面底部有返回审核页面按钮，点击返回审核页面。



#### 团购 -> 商品管理 -> 待二审的商品 ####

**查询**

> 以商品编号、商品名称（模糊查询）、审核状态(audit_status=4)、商品状态为查询条件，以列表的形式进行展示，列表项：
> 
> 商品编码、商品标题、商品库存、仓库类型、是否有享网做图、市场价、有享价、商品分类、商品状态、审核状态、商品来源、是否首页显示、浏览次数、上架时间、下架时间、添加时间。
> <span style="color:red">按照上架时间升序来排序。</span>

**查看详细**

> 同所有商品的查看详细功能。


**审核**

> 选中商品，点击审核按钮，进入审核页面，页面内容：同查看详细页面，页面底部有审核意见编辑框、<span style="color:red">商品关联的运费模板及明细</span>、二审通过按钮、二审不通过按钮、修改按钮。
> 
> 二审通过
> 
>	点击二审通过按钮，需做如下处理：
>
>	1、<span style="color:red">验证该商品是否为待二审状态，若不是，则不能审核。</span>
>
>	2、验证：所属售后客服、详细页面主图、往期团购图片、新版列表图片、搜狗API图片，以上字段不能为空。
>
>   3、商品的审核状态置为二审通过(audit_status=5)。
>
>   4、审核意见若没有填写，直接给审核意见赋值——‘二审通过’。
>
>	5、若审核意见不为空，则在审核意见前面加上‘二审通过：’
 
> 二审不通过
> 
>	点击而审不通过按钮，需做如下处理：
>	
>	1、<span style="color:red">验证该商品是否为待二审状态，若不是，则不能审核。</span>
>	
>	2、商品审核状态置为二审不通过（audit_status=6）。
>	
>	3、审核意见需要填写，并在审核意见前面加上‘二审不通过：’，若为空，则不能提交。
> 
> 修改
> 
	同现有后台的修改功能，修改完成后，跳往审核页面。
>
	建议：如果使用现有的修改页面，则需要加参数区分，从二审页面过来的，底部有返回审核页面按钮，保存后返回审核页面。
		 如果是直接点击修改的，底部没有返回审核页面按钮，保存后返回所有商品列表，并查询出修改的那个商品。
>


#### 团购 -> 商品管理 -> 待三审的商品 ####

**查看详细**

> 同所有商品的查看详细功能。


**审核**

> 选中商品，点击审核按钮，进入审核页面，页面内容：同查看详细页面，页面底部有审核意见编辑框、<span style="color:red">商品关联的运费模板及明细</span>、三审通过按钮、三审不通过按钮。
> 
> 三审通过
> 
>	点击三审通过按钮，需做如下处理：
>
>	1、<span style="color:red">验证该商品是否为待三审状态，若不是，则不能审核。</span>
>	
>	2、商品的审核状态置为三审通过(audit_status=7)。
>	
>   3、审核意见若没有填写，直接给审核意见赋值——‘三审通过’。
>   
>   4、若审核意见不为空，则在审核意见前面加上“三审通过：”

> <span style="color:red">三审不通过</span>
> 
>	点击三审不通过按钮，需做如下处理：
>	
>	1、<span style="color:red">验证该商品是否为待三审状态，若不是，则不能审核。</span>
>	
>	2、商品的审核状态为三审不通过（audit_status=8）。
>	
>	3、审核意见需要填写，并在审核意见前面加上‘三审不通过：’，若为空则不能提交。

#### 团购 -> 物流管理 -> 运费模版管理 ####

**关联店铺**

> 选中一个运费模板，点击关联店铺按钮，<span style="color:red">判断该运费模板的添加来源是否是供应商（Postagemode.add_from=1），若是，则不能关联，并给出提示。</span> 
> 若不是，跳转到关联店铺页面，页面内容：
> 
> 运费模板名称、已关联的店铺列表（店铺名称，操作【删除】）、店铺下拉列表（已关联的店铺，不显示在这个下拉列表中）、提交按钮。
> 
> 选中一个店铺，点击提交按钮，判断该店铺是否与该运费模板是否已关联（查找shop_postagemode），若已关联，则不能添加，并给出相应的提示信息。
> 
> 若未关联，则将店铺ID、运费模板ID、当前用户、当前时间写入到数据库中。
>　
> 
> 【删除】
> 
	点击已关联列表中的删除链接，判断该店铺有没有商品（不管商品状态）使用了这个运费模版，如果有，则不能删除，给出提示
	若没有，将该店铺与运费模板的关联删除掉（操作shop_postagemode即可）。

##数据库设计##

###商品表 item, 该表已存在 ###

<table>
	<thead>
		<tr>
			<th>数据成员名称</th>
			<th>数据成员类型</th>
			<th>是否为空</th>
			<th>说明</th>
		</tr>
	</thead>
	<tbody>		
		<tr>
			<td>audit_status</td>
			<td>int</td>
			<td>否</td>
			<td>商品审核状态， 1、编辑中 2、待一审 3、一审不通过 4、待二审 5、二审通过 6、二审不通过，7、三审通过、<span style="color:red">8、三审不通过</span>，默认为1</td>
		</tr>
		<tr>
			<td>add_from</td>
			<td>int</td>
			<td>否</td>
			<td>商品添加来源，1：有享网后台，2：供应商，默认为1</td>
		</tr>
		<tr>
			<td>is_edit</td>
			<td>int</td>
			<td>否</td>
			<td>商品是否修改，0：未修改，1：已修改，默认为0，用于复制商品，复制的商品只能修改过之后才能提交</td>
		</tr>
		<tr>
			<td>is_require_make_pic</td>
			<td>int</td>
			<td>否</td>
			<td>是否有享网做图 0：不是 1：是，默认为0</td>
		</tr>
		<tr>
			<td>mark</td>
			<td>text</td>
			<td></td>
			<td>备注，商家要是需要提供做图服务，需要填写相关的备注</td>
		</tr>
		<tr>
			<td>cancel_audited_date</td>
			<td>datetime</td>
			<td></td>
			<td>最后一次撤销审核时间</td>
		</tr>
	</tbody>
</table>

###商品审核意见表 item\_audit\_suggesion ###
<table>
	<thead>
		<tr>
			<th>数据成员名称</th>
			<th>数据成员类型</th>
			<th>是否为空</th>
			<th>说明</th>
		</tr>
	</thead>
	<tbody>		
		<tr>
			<td>iasid</td>
			<td>int</td>
			<td>否</td>
			<td>ID，自增，主键</td>
		</tr>
		<tr>
			<td>iid</td>
			<td>varchar(50)</td>
			<td>否</td>
			<td>商品编号</td>
		</tr>
		<tr>
			<td>audit_type</td>
			<td>int</td>
			<td>否</td>
			<td>审核类型，1：一审  2、二审</td>
		</tr>
		<tr>
			<td>suggestion</td>
			<td>text</td>
			<td>否</td>
			<td>审核意见</td>
		</tr>
		<tr>
			<td>audited_user</td>
			<td>varchar(50)</td>
			<td>否</td>
			<td>审核人</td>
		</tr>
		<tr>
			<td>mark</td>
			<td>text</td>
			<td></td>
			<td>备注</td>
		</tr>
		<tr>
			<td>created_date</td>
			<td>datetime</td>
			<td>否</td>
			<td>创建时间</td>
		</tr>
	</tbody>
</table>


### <span style="color:red">运费模板表 PostageMode 该表已存在</span> ###
<table>
	<thead>
		<tr>
			<th>数据成员名称</th>
			<th>数据成员类型</th>
			<th>是否为空</th>
			<th>说明</th>
		</tr>
	</thead>
	<tbody>		
		<tr>
			<td>add_from</td>
			<td>int</td>
			<td>否</td>
			<td>添加来源，0:有享网，1：供应商。默认0</td>
		</tr>
		<tr>
			<td>shid</td>
			<td>int</td>
			<td></td>
			<td>商家ID， add_from=1有效</td>
		</tr>
	</tbody>
</table>

###商家运费模板关联表shop_postagemode ###

<table>
	<thead>
		<tr>
			<th>数据成员名称</th>
			<th>数据成员类型</th>
			<th>是否为空</th>
			<th>说明</th>
		</tr>
	</thead>
	<tbody>		
		<tr>
			<td>spid</td>
			<td>int</td>
			<td>否</td>
			<td>ID，自增，主键</td>
		</tr>
		<tr>
			<td>shid</td>
			<td>int</td>
			<td>否</td>
			<td>商家ID</td>
		</tr>
		<tr>
			<td>pmId</td>
			<td>int</td>
			<td>否</td>
			<td>运费模板ID</td>
		</tr>
		<tr>
			<td>created_user</td>
			<td>varchar(50)</td>
			<td>否</td>
			<td>创建人</td>
		</tr>
		<tr>
			<td>created_date</td>
			<td>datetime</td>
			<td>否</td>
			<td>创建时间</td>
		</tr>
	</tbody>
</table>