
#团购红包商品#


##功能说明##

### yofogoadmin -> 团购 -> 商品管理 -> 所有商品 ###

**新增**

> 在原基础上，商品类型新增红包商品，商品类型选择红包商品后，需增加如下内容：
> 
	1、原价格变为红包值（写入到数据库时，还是将红包值放入到marketPrice这个字段），商品类型下方显示红包到期时间（不能小于当前时间）。
	2、不可以使用红包，将是否可以使用红包这项置为不可用，默认为不可以。
> 
> 点击提交时，需要做如下验证：
> 
	1、验证SKU分类是否选择了无SKU属性。
 	2、红包到期时间是否大于当前时间。
	3、运费模版只能选择免运费模版。
	4、有享价需大于0。

**修改**

> 同添加。

### yofogoGroup ###


**购物车**

> 进入购物车页面，判断若是红包商品，则将配送信息中的配送地址、配送物流及其他信息都隐藏掉。
> 
> 点击提交后，需做如下处理：
> 
	1、收货人姓名、收货人的所在省份、收货人的所在城市、收货人的所在地区、收货人的详细地址、
	   收货人的邮编、收货人的手机号码、收货人的电话号码不写入数据库中。
    2、物流方式置为virtual(虚拟物品)

**订单详细页面**

> 如果是红包商品，收件人、收货地址、手机号码、物流方式、备注信息以及修改信息按钮，都要隐藏掉。

**支付**

> 若是红包商品，支付完成后，需做如下操作：
> 
	1、修改该用户的红包总额。
	2、将该红包数据 插入到Coupons表中，所属用户为当前购买该红包的用户，外部编号为该红包的订单号，来自团购系统，
       生效时间为当前时间，过期时间为红包的过期时间。
    3、不将该订单数据插入到OrdersNew表中。
	4、订单支付完成后，订单直接为完成状态

**对账**

> 支付和支付掉单对账


##数据库设计##

###商品信息表(item)###
<table>
	<thead>
		<tr>
			<td>数据成员名称</td>
			<td>数据成员类型</td>
			<td>是否为空</td>
			<td>说明</td>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>types</td>
			<td>int</td>
			<td>否</td>
			<td>商品类型(1普通商品、2手机短信消费、3秒杀、4活动商品、5链接商品、6合约机商品、7红包商品)，默认1</td>
		</tr>
		<tr>
			<td>coupon_end_date</td>
			<td>datetime</td>
			<td></td>
			<td>红包到期时间， types=7有效</td>
		</tr>
	</tbody>
</table>


###主订单表(orders)###
<table>
	<thead>
		<tr>
			<td>数据成员名称</td>
			<td>数据成员类型</td>
			<td>是否为空</td>
			<td>说明</td>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>types</td>
			<td>int</td>
			<td>否</td>
			<td>交易类型(1普通商品、2手机短信消费、3秒杀、4活动商品、5链接商品、6合约机商品、7红包商品)，默认1</td>
		</tr>
	</tbody>
</table>
